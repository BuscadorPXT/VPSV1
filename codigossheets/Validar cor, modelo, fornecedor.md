const

REGRAS_FORNECEDORES = {
  // Copie e cole a lista de aliases fornecida aqui.
  // Exemplo da estrutura já aplicada abaixo.
  "ABE CELL": { "codigo": "1995", "aliases": ["ABE", "ABE CELULAR", "ABECELL", "ABE CEL", "ABECEL"] },
  "AYOUB": { "codigo": "8825", "aliases": ["AIUB", "AYUB", "AIOUB"] },
  "ADAMS SHOP": { "codigo": "5803", "aliases": ["ADAMS", "ADAMSSHOP", "ADAM SHOP"] },
  "AJL IMPORTS": { "codigo": "0996", "aliases": ["AJL", "AJL IMPORTS", "AJLIMPORTS"] },  
  "ALFA CELL": { "codigo": "2092", "aliases": ["ALFA", "ALFACELL", "ALFA CEL", "ALPHA CELL", "ALPHA"] },
  "AMERICA MOBILE": { "codigo": "9706", "aliases": ["AMERICA", "AMERICAMOBILE", "AMERICA MOBI", "AMERICAMOBI", "MERICA MOBILE"] },
  "ARMANDO": { "codigo": "8723", "aliases": ["ARMANDO CELL", "ARMANDO SHOP"] },
  "ATACADO SHOP": { "codigo": "3014", "aliases": ["ATACADO", "ATACADOSHOP"] },
  "AZ SHOP": { "codigo": "1138", "aliases": ["Z", "Z SHOP", "AZ", "AZSHOP", "A Z SHOP"] },
  "AZUR": { "codigo": "2728", "aliases": ["AZUR CELL", "AZURE", "AZUL"] },
  "BAGDA": { "codigo": "0437", "aliases": ["BAGDÁ", "BAGHDA", "BAGDAH"] },
  "BAKOUR": { "codigo": "9939", "aliases": ["BAKUR", "BAKOUR CELL"] },
  "BANANA SHOP": { "codigo": "4079", "aliases": ["BANANA", "BANANASHOP"] },
  "BOB CELL": { "codigo": "0277", "aliases": ["BOB", "BOBCELL", "BOB CEL"] },
  "BROCK TECH": { "codigo": "2289", "aliases": ["BROCK", "BROCKTECH", "BROCK TEC"] },
  "BV CELULARES": { "codigo": "2707", "aliases": ["BV", "BV IMPORTS", "BV CELL", "BV CELULARES"] },  
  "BZ PHONES": { "codigo": "2233", "aliases": ["BZ", "BZPHONES", "B Z PHONES", "BZ PHONE"] },
  "CAPTAIN": { "codigo": "6286", "aliases": ["CAPTAIN CELL", "CAPITAIN", "CAPITAN"] },
  "CELL ZONE": { "codigo": "0938", "aliases": ["CELLZONE", "CEL ZONE", "CELZONE"] },
  "CLARICELL": { "codigo": "8556", "aliases": ["CLARI CELL", "CLARI", "CLARICEL", "CLARI CEL", "CLARA CELL"] },
  "CURY": { "codigo": "9755", "aliases": ["CURY CELL", "CURRY"] },
  "DIGITA CELL": { "codigo": "1063", "aliases": ["DIGITA", "DIGITACELL", "DIGITA CEL", "DIGITAL CELL"] },
  "DUBAI": { "codigo": "1272", "aliases": ["DUBAI CELL", "DUBAY", "DUBAI SHOP"] },
  "EASY STORE": { "codigo": "5113", "aliases": ["EASY STORE", "EASY", "EASYSTORE", "EAZY", "EASI"] },
  "ELETRO IMPORTS SP": { "codigo": "4836", "aliases": ["ELETRO IMPORTS", "ELETRO SP", "ELETROIMPORTS", "ELETRO IMPORT", "ELECTRO IMPORTS"] },
  "ELETRO KING": { "codigo": "3112", "aliases": ["ELETRO", "ELETROKING", "ELECTRO KING"] },
  "EMILIO SHOP": { "codigo": "3241", "aliases": ["EMILIO", "EMILIOSHOP"] },
  "F5": { "codigo": "7689", "aliases": ["F5 CELL", "F5 SHOP", "F 5", "F5"] },
  "FAST PHONE": { "codigo": "2343", "aliases": ["FAST", "FASTPHONE", "FAST PHONES"] },
  "FONIX": { "codigo": "3278", "aliases": ["PHOENIX", "FONIX CELL", "FOENIX"] },
  "GUGA ELETRO": { "codigo": "6267", "aliases": ["VIP", "VIPALI", "VIP ALI", "GUGA", "GUGAELETRO", "GUG ELETRO", "GUGA ELETRONICO"] },
  "H3": { "codigo": "4716", "aliases": ["H3 CELL", "H 3", "H3 SHOP"] },
  "HEREZ": { "codigo": "6940", "aliases": ["HERES", "HEREZ CELL", "HERREZ"] },
  "HH CELL": { "codigo": "1471", "aliases": ["HH", "HHCELL", "HH CEL", "H H CELL"] },
  "HM COMPANY": { "codigo": "4851", "aliases": ["HM", "HMCOMPANY", "HM COMP", "H M COMPANY"] },
  "HS IPHONES": { "codigo": "4206", "aliases": ["HS", "HSIPHONES", "HS IPHONE", "H S IPHONES"] },
  "IBIONIC": { "codigo": "6860", "aliases": ["I BIONIC", "IBIONIC CELL"] },
  "ILHA CELL": { "codigo": "2720", "aliases": ["ILHA", "ILHACELL", "ILHA CEL"] },
  "IMPORTADOS XFB": { "codigo": "1998", "aliases": ["IMPORTADO XFB", "XFB", "IMPORTS XFB"] },  
  "IPHONE WORLD": { "codigo": "0007", "aliases": ["IMAX", "IPHONEWORLD", "IPHONE WORD"] },
  "IMAX EXPRESS": { "codigo": "3333", "aliases": ["EXPRESS", "IMAXEXPRESS", "IMAX", "I MAX EXPRESS"] },
  "JR CELULARES": { "codigo": "0539", "aliases": ["JR", "JRCELULARES", "JR CEL", "J R CELULARES"] },
  "JOYCE": { "codigo": "1664", "aliases": ["JOYCE CELL", "JOICE"] },
  "KING SHOP": { "codigo": "4510", "aliases": ["KING", "KINGSHOP"] },
  "LA CASA": { "codigo": "0762", "aliases": ["LACASA", "LA CASA CELL"] },
  "LOJA 31": { "codigo": "0181", "aliases": ["LOJA31", "LOJA TRINTA E UM", "LOJA 3", "LOJA 31"] },
  "LOJA MESTRA": { "codigo": "5689", "aliases": ["MESTRA", "LOJAMESTRA"] },
  "MB ELETRÔNICOS": { "codigo": "6714", "aliases": ["MB", "MB ELETRONICOS", "MV ELETRONICOS", "MB ELETRO"] },
  "MEGA CELL": { "codigo": "3369", "aliases": ["MEGA CEL", "MEGACELL"] },
  "MEGA CENTER": { "codigo": "3821", "aliases": ["MEGACENTER", "MEGA CENTRE"] },
  "MEGA STORYA": { "codigo": "7308", "aliases": ["MEGA STORYIA", "MEGASTORYA", "MEGA STORY"] },
  "MEU CELULAR SP": { "codigo": "8881", "aliases": ["MEU CELULAR", "MEUCELULAR", "MEU CEL SP"] },
  "MIAMI ZONE": { "codigo": "4859", "aliases": ["MIAMI", "MIAMIZONE"] },
  "MIAMI STORE": { "codigo": "6881", "aliases": ["MIAMISTORE", "MIAMI STORE"] },
  "MUMBAI SHOP": { "codigo": "0449", "aliases": ["MUMBAI", "MUMBAISHOP"] },
  "MY PHONE SP": { "codigo": "4444", "aliases": ["MY PHONE", "MYPHONE", "MY", "MY FONE SP"] },
  "NASSER": { "codigo": "5307", "aliases": ["NASER", "NASSER CELL", "NASEER"] },
  "NY CELL": { "codigo": "8722", "aliases": ["NAZEN", "NAZEM CELL", "NY", "NYCELL", "NAZEM"] },
  "ON CELL": { "codigo": "5233", "aliases": ["ONCELL", "ON CEL"] },
  "PHONE LINK": { "codigo": "9823", "aliases": ["PHONELINK", "PHONE LNK"] },
  "PLANETA": { "codigo": "0400", "aliases": ["PLANETA CELL", "PLANETTA"] },
  "PRO PHONE": { "codigo": "8077", "aliases": ["PROPHONE", "PRO PHONES", "PRO"] },
  "PHOENIX GABI": { "codigo": "1693", "aliases": ["PXT", "PHOENIX", "PHOENIXGABI", "GABI"] },
  "RAYZA": { "codigo": "4198", "aliases": ["RAIZA", "RAISA", "RAYSA"] },
  "RED CELL": { "codigo": "5519", "aliases": ["REDCELL", "RED CEL", "REDCEL"] },
  "REI DO IPHONE": { "codigo": "0250", "aliases": ["REI", "REIDOIPHONE", "REI IPHONE"] },
  "STAR GAMES": { "codigo": "0430", "aliases": ["STAR", "TARGAMES", "STARGAMES", "STAR GAMES"] },
  "SELENA": { "codigo": "0613", "aliases": ["SELLENA", "SELENA CELL"] },
  "SOUNA": { "codigo": "1359", "aliases": ["SOUNA CELL", "SONA"] },
  "SMART CELL": { "codigo": "4907", "aliases": ["SMART", "SMARTCEL", "SMARTCELL", "SMART CEL"] },
  "SHOP CELL": { "codigo": "7229", "aliases": ["SHOP", "SHOPCELL", "SHOP CEL"] },
  "SÓ IPHONE": { "codigo": "9530", "aliases": ["SO IPHONE", "SOIPHONE"] },
  "TALLA CELL": { "codigo": "6603", "aliases": ["TALLA", "TALA", "TALLACELL", "TALLA CEL", "TALA CELL"] },
  "TIO SAM": { "codigo": "6169", "aliases": ["TIOSAM", "TIO SAM CELL"] },
  "T.I.T CELL": { "codigo": "5796", "aliases": ["TIT CELL", "TIT", "T.I.T", "TITCELL"] },
  "TM CELULARES": { "codigo": "7618", "aliases": ["TM", "TMCELULARES", "TM CEL", "T M CELULARES"] },
  "TOP ELETRONICOS": { "codigo": "2459", "aliases": ["TOP", "TOPELETRONICOS", "TOP ELETRO"] },
  "TREND": { "codigo": "5593", "aliases": ["TREMD", "TREND CELL", "REND"] },
  "TROY CELL": { "codigo": "4004", "aliases": ["TROY", "TROYCEL", "TROYCELL", "TROY CEL"] },
  "ULTRA STORE": { "codigo": "7915", "aliases": ["ULTRA", "ULTRASTORE"] },
  "BINAN CELL": { "codigo": "1111", "aliases": ["BINAN", "BINANCELL", "BINAN CEL"] },
  "B.A IMPORTS": { "codigo": "6238", "aliases": ["BA IMPORTS", "B.A", "BA", "BAIMPORTS", "B A IMPORTS"] },
  "GK ATACADO": { "codigo": "4590", "aliases": ["GK", "GKATACADO", "G K ATACADO"] },
  "KA EXPRESS": { "codigo": "5749", "aliases": ["KA", "KAEXPRESS", "K A EXPRESS"] },
  "MUNDO DO IPHONE": { "codigo": "5805", "aliases": ["MUNDO IPHONE", "MUNDODOIPHONE", "MUNDO DO IFONE"] },
  "PRIME CELL": { "codigo": "9610", "aliases": ["PRIME", "PRIMECELL", "PRIME CEL"] },
  "XFB": { "codigo": "8640", "aliases": ["XFBE", "X FB", "XF B"] },
  "X MEN": { "codigo": "4408", "aliases": ["XMEN", "X-MEN", "X MAN"] },
  "ZEIN TECH MOBILE": { "codigo": "7574", "aliases": ["ZEIN", "ZEIN TECH", "ZEINTECHMOBILE", "ZEIN TEC"] },
  "ZN CELL": { "codigo": "5792", "aliases": ["ZN", "ZNCELL", "ZN CEL", "Z N CELL"] },
  "WEE SHOP": { "codigo": "9998", "aliases": ["WEE", "WEESHOP"] },
  "W ATACADO": { "codigo": "7412", "aliases": ["WATACADO", "W ATACADO SHOP"] },
  "ZOI CELL": { "codigo": "9959", "aliases": ["ZOI", "ZOICELL", "ZOI CEL", "ZOIO"] },
  "RAWAN IMPORT": { "codigo": "3294", "aliases": ["RAWAN", "RAWA"] },
  "KINGDON ELETRONICOS": { "codigo": "8211", "aliases": ["KINGDON", "KINGDON ELETRONICO"] },
  "DUBAI SHOP": { "codigo": "4017", "aliases": ["DUBAISHOP", "DUBAI SHOPPING"] },
  "BRASIL GAMES": { "codigo": "9770", "aliases": ["BR GAMES", "BRASILGAMES"] },
  "DISC IMPORTADOS": { "codigo": "2657", "aliases": ["DISC IMPORTADOS", "DISC"] },
  "TUDO APPLE": { "codigo": "6593", "aliases": ["TUDO APPLE", "TUDOAPPLE"] },
  "CORRE DA MAÇA": { "codigo": "4700", "aliases": ["CORRE DA MACA", "CORREDAMACA"] },
  "PRIMOS CELL": { "codigo": "4777", "aliases": ["PRIMOS", "PRIMOSCELL", "PRIMOS CEL"] }
};

const REGRAS_DE_CORES = {
  // iPhone
  "IPHONE 13 PRO": {
    "conversoes": { "PRETO": "GRAPHITE", "BLACK": "GRAPHITE", "SPACE BLACK": "GRAPHITE", "BRANCO": "SILVER", "WHITE": "SILVER", "VERDE": "ALPINE GREEN", "GREEN": "ALPINE GREEN" },
    "coresValidas": ["SIERRA BLUE", "SILVER", "GOLD", "GRAPHITE", "ALPINE GREEN"]
  },
  "IPHONE 13": {
    "conversoes": { "BLACK": "MIDNIGHT", "WHITE": "STARLIGHT" },
    "coresValidas": ["MIDNIGHT", "STARLIGHT", "PINK", "BLUE", "GREEN", "RED"]
  },
  "IPHONE 13 PRO MAX": {
    "conversoes": { "MIDNIGHT": "GRAPHITE", "PRETO": "GRAPHITE", "BLACK": "GRAPHITE", "SPACE BLACK": "GRAPHITE", "BRANCO": "SILVER", "WHITE": "SILVER", "VERDE": "ALPINE GREEN", "GREEN": "ALPINE GREEN" },
    "coresValidas": ["SIERRA BLUE", "SILVER", "GOLD", "GRAPHITE", "ALPINE GREEN"]
  },
  "IPHONE 14 PRO": {
    "conversoes": { "BLACK": "SPACE BLACK", "PRETO": "SPACE BLACK", "WHITE": "SILVER", "BRANCO": "SILVER" },
    "coresValidas": ["DEEP PURPLE", "GOLD", "SILVER", "SPACE BLACK"]
  },
  "IPHONE 14": {
    "conversoes": { "WHITE": "STARLIGHT", "BLACK": "MIDNIGHT" },
    "coresValidas": ["PURPLE", "BLUE", "MIDNIGHT", "STARLIGHT", "RED", "YELLOW"]
  },
  "IPHONE 15 PRO": {
    "conversoes": {"SILVER": "WHITE TITANIUM"},
    "coresValidas": ["BLACK TITANIUM", "WHITE TITANIUM", "NATURAL TITANIUM", "BLUE TITANIUM"]
  },
  "IPHONE 15": {
    "conversoes": { "TEAL": "GREEN", "ULTRA MARINE": "BLUE", "MIDNIGHT": "BLACK", "ULTRAMARINE": "BLUE", "ROSE": "PINK"},
    "coresValidas": ["BLACK", "STARLIGHT", "PINK", "BLUE", "GREEN", "RED", "YELLOW"]
  },
  "IPHONE 15 PRO MAX": {
    "conversoes": {"SILVER": "WHITE TITANIUM", "GRAPHITE": "BLACK TITANIUM", "SPACE BLACK": "BLACK TITANIUM"},
    "coresValidas": ["BLACK TITANIUM", "WHITE TITANIUM", "NATURAL TITANIUM", "BLUE TITANIUM"]
  },
  "IPHONE 15 PRO MAX CPO": {
    "conversoes": {"SILVER": "WHITE TITANIUM", "GRAPHITE": "BLACK TITANIUM", "SPACE BLACK": "BLACK TITANIUM", "BLACK": "BLACK TITANIUM"},
    "coresValidas": ["BLACK TITANIUM", "WHITE TITANIUM", "NATURAL TITANIUM", "BLUE TITANIUM"]
  },
  "IPHONE 16E": {
    "conversoes": {"BRANCO": "WHITE", "STARLIGHT": "WHITE", "MIDNIGHT": "BLACK", "PRETO": "BLACK"},
    "coresValidas": ["BLACK", "WHITE", "PINK", "ULTRAMARINE", "TEAL"]
  },
  "IPHONE 16": {
    "conversoes": {
        "GREEN": "TEAL",
        "VERDE": "TEAL",
        "BLUE": "ULTRAMARINE",
        "AZUL": "ULTRAMARINE",
        "BRANCO": "WHITE",
        "MIDNIGHT": "BLACK",
        "PRETO": "BLACK",
        "ROSA": "PINK"  
    },
    "coresValidas": [
        "BLACK",
        "WHITE",
        "PINK",
        "ULTRAMARINE",
        "TEAL"
    ]
  },
  "IPHONE 16 PRO": {
    "conversoes": {"WHITE": "WHITE TITANIUM", "BLACK": "BLACK TITANIUM", "NATURAL": "NATURAL TITANIUM", "DESERT": "DESERT TITANIUM" },
    "coresValidas": ["BLACK TITANIUM", "WHITE TITANIUM", "NATURAL TITANIUM", "DESERT TITANIUM"]
  },
  "IPHONE 16 PRO MAX": {
    "conversoes": {"WHITE": "WHITE TITANIUM", "BLACK": "BLACK TITANIUM", "NATURAL": "NATURAL TITANIUM", "DESERT": "DESERT TITANIUM" },
    "coresValidas": ["BLACK TITANIUM", "WHITE TITANIUM", "NATURAL TITANIUM", "DESERT TITANIUM"]
  },
 "IPHONE 17": {
    "conversoes": {
      "GREEN": "SAGE",
      "VERDE": "SAGE",
      "BLUE": "MIST BLUE",
      "DEEP BLUE": "MIST BLUE",
      "AZUL": "MIST BLUE",
      "BRANCO": "WHITE",
      "CLOUD WHITE": "WHITE",
      "SILVER": "WHITE",
      "PRATA": "WHITE",
      "MIDNIGHT": "BLACK",
      "SPACE BLACK": "BLACK",
      "PRETO": "BLACK",
      "PINK": "LAVENDER",
      "ROSA": "LAVENDER"
    },
    "coresValidas": ["BLACK", "WHITE", "LAVENDER", "MIST BLUE", "SAGE"]
  },
  

  "IPHONE 17 PRO": {
    "conversoes": {"LARANJA": "COSMIC ORANGE", "ORANGE": "COSMIC ORANGE", "DESERT TITANIUM": "COSMIC ORANGE", "DESERT": "COSMIC ORANGE", "WHITE": "SILVER", "BRANCO": "SILVER", "NATURAL": "SILVER", "NATURAL TITANIUM": "SILVER", "AZUL": "DEEP BLUE", "BLUE": "DEEP BLUE"},
    "coresValidas": ["COSMIC ORANGE", "DEEP BLUE", "SILVER"]
  },
  "IPHONE 17 PRO MAX": {
    "conversoes": {"LARANJA": "COSMIC ORANGE", "ORANGE": "COSMIC ORANGE", "DESERT TITANIUM": "COSMIC ORANGE", "DESERT": "COSMIC ORANGE", "WHITE": "SILVER", "BRANCO": "SILVER", "NATURAL": "SILVER", "NATURAL TITANIUM": "SILVER", "AZUL": "DEEP BLUE", "BLUE": "DEEP BLUE"},
    "coresValidas": ["COSMIC ORANGE", "DEEP BLUE", "SILVER"]
  },
  "IPHONE 17 AIR": {
    "conversoes": {"WHITE": "CLOUD WHITE", "BLACK": "SPACE BLACK", "MIDNIGHT": "SPACE BLACK", "SPACE GRAY": "SPACE BLACK", "BLUE": "SKY BLUE", "MIST BLUE": "SKY BLUE", "ULTRA MARINE": "SKY BLUE", "GOLD": "LIGHT GOLD"},
    "coresValidas": ["SKY BLUE", "LIGHT GOLD", "CLOUD WHITE", "SPACE BLACK"]
  },

  // ------------------------------ IPADS -------------------------------
  "IPAD 9": {
    "conversoes": { "BLACK": "SPACE GRAY", "PRETO": "SPACE GRAY", "MIDNIGHT": "SPACE GRAY", "BLUE": "SPACE GRAY", "WHITE": "SILVER", "PRATA": "SILVER", "BRANCO": "SILVER", "STARLIGHT": "SILVER", "YELLOW": "SILVER" },
    "coresValidas": ["SILVER", "SPACE GRAY"]
  },
  "IPAD 10": {
    "conversoes": { "AZUL": "BLUE", "AZUE": "BLUE", "WHITE": "SILVER", "PRATA": "SILVER", "BRANCO": "SILVER", "STARLIGHT": "YELLOW", "ROSA": "PINK", "PURPLE": "PINK" },
    "coresValidas": ["SILVER", "BLUE", "PINK", "YELLOW"]
  },
  "IPAD 11": {
    "conversoes": { "ROSA": "PINK", "PURPLE": "PINK", "AZUL": "BLUE", "AZUE": "BLUE", "WHITE": "SILVER", "PRATA": "SILVER", "BRANCO": "SILVER", "STARLIGHT": "SILVER" },
    "coresValidas": ["SILVER", "BLUE", "PINK", "YELLOW"]
  },
  "IPAD MINI 6": {
    "conversoes": { "ROSA": "PINK", "PRETO": "SPACE GRAY", "BLACK": "SPACE GRAY", "MIDNIGHT": "SPACE GRAY", "WHITE": "STARLIGHT", "PRATA": "STARLIGHT", "BRANCO": "STARLIGHT" },
    "coresValidas": ["SPACE GRAY", "PINK", "PURPLE", "STARLIGHT"]
  },
  "IPAD MINI 7": {
    "conversoes": { "ROSA": "PINK", "AZUL": "BLUE", "AZUE": "BLUE", "PRETO": "SPACE GRAY", "BLACK": "SPACE GRAY", "MIDNIGHT": "SPACE GRAY", "WHITE": "STARLIGHT", "PRATA": "STARLIGHT", "BRANCO": "STARLIGHT" },
    "coresValidas": ["SPACE GRAY", "BLUE", "PURPLE", "STARLIGHT"]
  },
  "IPAD AIR M1": {
    "conversoes": { "ROSA": "PINK", "ROXO": "PURPLE", "AZUL": "BLUE", "AZUE": "BLUE", "PRETO": "SPACE GRAY", "BLACK": "SPACE GRAY", "MIDNIGHT": "SPACE GRAY", "SPACE BLACK": "SPACE GRAY", "WHITE": "STARLIGHT", "PRATA": "STARLIGHT", "BRANCO": "STARLIGHT" },
    "coresValidas": ["SPACE GRAY", "BLUE", "PINK", "PURPLE", "STARLIGHT"]
  },
  "IPAD AIR M2": {
    "conversoes": { "ROSA": "PURPLE", "ROXO": "PURPLE", "PINK": "PURPLE", "AZUL": "BLUE", "AZUE": "BLUE", "PRETO": "SPACE GRAY", "BLACK": "SPACE GRAY", "MIDNIGHT": "SPACE GRAY", "SPACE BLACK": "SPACE GRAY", "WHITE": "STARLIGHT", "PRATA": "STARLIGHT", "BRANCO": "STARLIGHT" },
    "coresValidas": ["SPACE GRAY", "BLUE", "PURPLE", "STARLIGHT"]
  },
  "IPAD AIR M3": {
    "conversoes": { "ROSA": "PURPLE", "ROXO": "PURPLE", "PINK": "PURPLE", "AZUL": "BLUE", "AZUE": "BLUE", "PRETO": "SPACE GRAY", "BLACK": "SPACE GRAY", "MIDNIGHT": "SPACE GRAY", "SPACE BLACK": "SPACE GRAY", "WHITE": "STARLIGHT", "PRATA": "STARLIGHT", "BRANCO": "STARLIGHT", "SILVER": "STARLIGHT" },
    "coresValidas": ["SPACE GRAY", "BLUE", "PURPLE", "STARLIGHT"]
  },
  "IPAD PRO 5": {
    "conversoes": { "PRETO": "SPACE GRAY", "BLACK": "SPACE GRAY", "MIDNIGHT": "SPACE GRAY", "SPACE BLACK": "SPACE GRAY", "WHITE": "SILVER", "PRATA": "SILVER", "BRANCO": "SILVER", "STARLIGHT": "SILVER" },
    "coresValidas": ["SPACE GRAY", "SILVER"]
  },
  "IPAD PRO M4": {
    "conversoes": { "PRETO": "SPACE BLACK", "BLACK": "SPACE BLACK", "MIDNIGHT": "SPACE BLACK", "SPACE GRAY": "SPACE BLACK", "WHITE": "SILVER", "PRATA": "SILVER", "BRANCO": "SILVER", "STARLIGHT": "SILVER" },
    "coresValidas": ["SPACE BLACK", "SILVER"]
  },
  "IPAD PRO M5": {
    "conversoes": { "PRETO": "SPACE BLACK", "BLACK": "SPACE BLACK", "MIDNIGHT": "SPACE BLACK", "SPACE GRAY": "SPACE BLACK", "WHITE": "SILVER", "PRATA": "SILVER", "BRANCO": "SILVER", "STARLIGHT": "SILVER" },
    "coresValidas": ["SPACE BLACK", "SILVER"]
  },
  "IPAD PRO M5": {
    "conversoes": { "PRETO": "SPACE BLACK", "BLACK": "SPACE BLACK", "MIDNIGHT": "SPACE BLACK", "SPACE GRAY": "SPACE BLACK", "WHITE": "SILVER", "PRATA": "SILVER", "BRANCO": "SILVER", "STARLIGHT": "SILVER" },
    "coresValidas": ["SPACE BLACK", "SILVER"]
  },
  "IPAD PRO M5": {
    "conversoes": { "PRETO": "SPACE BLACK", "BLACK": "SPACE BLACK", "MIDNIGHT": "SPACE BLACK", "SPACE GRAY": "SPACE BLACK", "WHITE": "SILVER", "PRATA": "SILVER", "BRANCO": "SILVER", "STARLIGHT": "SILVER" },
    "coresValidas": ["SPACE BLACK", "SILVER"]
  },
  // ----------------------------- MACBOOKS -----------------------------
  "MACBOOK AIR M1": {
    "conversoes": { "PRETO": "SPACE GRAY", "BLACK": "SPACE GRAY", "MIDNIGHT": "SPACE GRAY", "SPACE BLACK": "SPACE GRAY", "WHITE": "SILVER", "PRATA": "SILVER", "BRANCO": "SILVER", "STARLIGHT": "GOLD", "DOURADO": "GOLD" },
    "coresValidas": ["SPACE GRAY", "SILVER", "GOLD"]
  },
  "MACBOOK AIR M2": {
    "conversoes": { "PRETO": "MIDNIGHT", "BLACK": "MIDNIGHT", "SPACE BLACK": "SPACE GRAY", "WHITE": "SILVER", "PRATA": "SILVER", "BRANCO": "SILVER", "GOLD": "STARLIGHT", "DOURADO": "STARLIGHT" },
    "coresValidas": ["STARLIGHT", "MIDNIGHT", "SPACE GRAY", "SILVER"]
  },
  "MACBOOK AIR M3": {
    "conversoes": { "PRETO": "MIDNIGHT", "BLACK": "MIDNIGHT", "SPACE BLACK": "SPACE GRAY", "WHITE": "SILVER", "PRATA": "SILVER", "BRANCO": "SILVER", "GOLD": "STARLIGHT", "DOURADO": "STARLIGHT" },
    "coresValidas": ["STARLIGHT", "MIDNIGHT", "SPACE GRAY", "SILVER"]
  },
  "MACBOOK AIR M4": {
    "conversoes": { "SKY": "SKY BLUE", "AZUL": "SKY BLUE", "BLUE": "SKY BLUE", "GOLD": "STARLIGHT", "PRETO": "MIDNIGHT", "BLACK": "MIDNIGHT", "SPACE BLACK": "MIDNIGHT", "SPACE GRAY": "MIDNIGHT", "WHITE": "SILVER", "PRATA": "SILVER", "BRANCO": "SILVER", "DOURADO": "STARLIGHT" },
    "coresValidas": ["STARLIGHT", "MIDNIGHT", "SKY BLUE", "SILVER"]
  },
  "MACBOOK AIR M5": {
    "conversoes": { "SKY": "SKY BLUE", "AZUL": "SKY BLUE", "BLUE": "SKY BLUE", "GOLD": "STARLIGHT", "PRETO": "MIDNIGHT", "BLACK": "MIDNIGHT", "SPACE BLACK": "MIDNIGHT", "SPACE GRAY": "MIDNIGHT", "WHITE": "SILVER", "PRATA": "SILVER", "BRANCO": "SILVER", "DOURADO": "STARLIGHT" },
    "coresValidas": ["STARLIGHT", "MIDNIGHT", "SKY BLUE", "SILVER"]
  },
  "MACBOOK AIR M5": {
    "conversoes": { "SKY": "SKY BLUE", "AZUL": "SKY BLUE", "BLUE": "SKY BLUE", "GOLD": "STARLIGHT", "PRETO": "MIDNIGHT", "BLACK": "MIDNIGHT", "SPACE BLACK": "MIDNIGHT", "SPACE GRAY": "MIDNIGHT", "WHITE": "SILVER", "PRATA": "SILVER", "BRANCO": "SILVER", "DOURADO": "STARLIGHT" },
    "coresValidas": ["STARLIGHT", "MIDNIGHT", "SKY BLUE", "SILVER"]
  },
  "MACBOOK AIR M5": {
    "conversoes": { "SKY": "SKY BLUE", "AZUL": "SKY BLUE", "BLUE": "SKY BLUE", "GOLD": "STARLIGHT", "PRETO": "MIDNIGHT", "BLACK": "MIDNIGHT", "SPACE BLACK": "MIDNIGHT", "SPACE GRAY": "MIDNIGHT", "WHITE": "SILVER", "PRATA": "SILVER", "BRANCO": "SILVER", "DOURADO": "STARLIGHT" },
    "coresValidas": ["STARLIGHT", "MIDNIGHT", "SKY BLUE", "SILVER"]
  },
  "MACBOOK PRO M3 PRO": {
    "conversoes": { "MIDNIGHT": "SPACE BLACK", "PRETO": "SPACE BLACK", "BLACK": "SPACE BLACK", "SPACE GRAY": "SPACE BLACK", "WHITE": "SILVER", "PRATA": "SILVER", "BRANCO": "SILVER", "STARLIGHT": "SILVER" },
    "coresValidas": ["SPACE BLACK", "SILVER"]
  },
  "MACBOOK PRO M3 MAX": {
    "conversoes": { "MIDNIGHT": "SPACE BLACK", "PRETO": "SPACE BLACK", "BLACK": "SPACE BLACK", "SPACE GRAY": "SPACE BLACK", "WHITE": "SILVER", "PRATA": "SILVER", "BRANCO": "SILVER", "STARLIGHT": "SILVER" },
    "coresValidas": ["SPACE BLACK", "SILVER"]
  },
  "MACBOOK PRO M3": {
    "conversoes": { "MIDNIGHT": "SPACE GRAY", "PRETO": "SPACE GRAY", "BLACK": "SPACE GRAY", "SPACE BLACK": "SPACE GRAY", "WHITE": "SILVER", "PRATA": "SILVER", "BRANCO": "SILVER", "STARLIGHT": "SILVER" },
    "coresValidas": ["SPACE GRAY", "SILVER"]
  },
  "MACBOOK PRO M4": {
    "conversoes": { "MIDNIGHT": "SPACE BLACK", "PRETO": "SPACE BLACK", "BLACK": "SPACE BLACK", "SPACE GRAY": "SPACE BLACK", "WHITE": "SILVER", "PRATA": "SILVER", "BRANCO": "SILVER", "STARLIGHT": "SILVER" },
    "coresValidas": ["SPACE BLACK", "SILVER"]
  },
  "MACBOOK PRO M5": {
    "conversoes": { "MIDNIGHT": "SPACE BLACK", "PRETO": "SPACE BLACK", "BLACK": "SPACE BLACK", "SPACE GRAY": "SPACE BLACK", "WHITE": "SILVER", "PRATA": "SILVER", "BRANCO": "SILVER", "STARLIGHT": "SILVER" },
    "coresValidas": ["SPACE BLACK", "SILVER"]
  },
  "MACBOOK PRO M5": {
    "conversoes": { "MIDNIGHT": "SPACE BLACK", "PRETO": "SPACE BLACK", "BLACK": "SPACE BLACK", "SPACE GRAY": "SPACE BLACK", "WHITE": "SILVER", "PRATA": "SILVER", "BRANCO": "SILVER", "STARLIGHT": "SILVER" },
    "coresValidas": ["SPACE BLACK", "SILVER"]
  },
  "MACBOOK PRO M5": {
    "conversoes": { "MIDNIGHT": "SPACE BLACK", "PRETO": "SPACE BLACK", "BLACK": "SPACE BLACK", "SPACE GRAY": "SPACE BLACK", "WHITE": "SILVER", "PRATA": "SILVER", "BRANCO": "SILVER", "STARLIGHT": "SILVER" },
    "coresValidas": ["SPACE BLACK", "SILVER"]
  },
  // Apple Watch
  "APPLE WATCH SE 2": {
    "conversoes": { "BLACK": "MIDNIGHT", "PRETO": "MIDNIGHT", "JET BLACK": "MIDNIGHT", "SPACE GRAY": "MIDNIGHT", "PINK": "STARLIGHT", "BRANCO": "SILVER", "ROSE": "STARLIGHT", "PRATA": "SILVER" },
    "coresValidas": ["MIDNIGHT", "SILVER", "STARLIGHT"]
  },
  "APPLE WATCH SE 3": {
    "conversoes": { "BLACK": "MIDNIGHT", "PRETO": "MIDNIGHT", "JET BLACK": "MIDNIGHT", "SPACE GRAY": "MIDNIGHT", "PINK": "STARLIGHT", "BRANCO": "STARLIGHT", "ROSE": "STARLIGHT", "PRATA": "STARLIGHT" },
    "coresValidas": ["MIDNIGHT", "STARLIGHT"]
  },
  "APPLE WATCH S9": {
    "conversoes": { "BLACK": "MIDNIGHT", "PRETO": "MIDNIGHT", "ROSE GOLD": "PINK"  },
    "coresValidas": ["MIDNIGHT", "PINK", "STARLIGHT", "SILVER", "RED"]
  },
  "APPLE WATCH S10": {
    "conversoes": { "BLACK": "JET BLACK", "PRETO": "JET BLACK", "MIDNIGHT": "JET BLACK", "SPACE GRAY": "JET BLACK", "PINK": "ROSE GOLD", "BRANCO": "SILVER", "ROSE": "ROSE GOLD", "PRATA": "SILVER" },
    "coresValidas": ["JET BLACK", "SILVER", "ROSE GOLD"]
  },
  "AIRPODS 4": {
    "conversoes": { "PRETO": "WHITE", "BLACK": "WHITE", "BRANCO": "WHITE" },
    "coresValidas": ["WHITE"]
  },
  "AIRPODS PRO 3": {
    "conversoes": { "PRETO": "WHITE", "BLACK": "WHITE", "BRANCO": "WHITE" },
    "coresValidas": ["WHITE"]
  }
  // Adicione novas regras para outros produtos aqui...
};

// Mapa de busca otimizado para fornecedores. É criado uma única vez.
const mapaDeBuscaFornecedores = new Map();
(function preencherMapaFornecedores() {
  const normalize = (str) => String(str || '').toUpperCase().replace(/[\s-]+/g, '');
  for (const nomeOficial in REGRAS_FORNECEDORES) {
    const info = REGRAS_FORNECEDORES[nomeOficial];
    const valorCorreto = `${nomeOficial} ${info.codigo}`;
    
    // Adiciona o nome oficial e seus aliases ao mapa
    mapaDeBuscaFornecedores.set(normalize(nomeOficial), valorCorreto);
    info.aliases.forEach(alias => {
      mapaDeBuscaFornecedores.set(normalize(alias), valorCorreto);
    });
  }
})();


/**
 * FUNÇÃO PRINCIPAL A SER CHAMADA PELO SEU FLUXO
 * Esta função orquestra a validação de todos os campos.
 */
function processarValidacoesNaEntrada(nomeDaAba) {
  const ss = SpreadsheetApp.getActiveSpreadsheet();
  // Usa o nome da aba fornecido
  const sheet = ss.getSheetByName(nomeDaAba); 
  if (!sheet || sheet.getLastRow() < 2) {
    Logger.log("Aba ENTRADA vazia ou não encontrada. Nenhuma validação executada.");
    return;
  }
  
  const range = sheet.getRange(2, 1, sheet.getLastRow() - 1, sheet.getLastColumn());
  let data = range.getValues();
  let logsGerais = [];

  // Executa as validações em sequência
  const [dataFornecedores, logsFornecedores] = validarECorrigirFornecedores(data);
  const [dataModelos, logsModelos] = validarModeloEGB(dataFornecedores);
  const [dataFinal, logsCores] = validarECorrigirCores(dataModelos);

  logsGerais = logsGerais.concat(logsFornecedores, logsModelos, logsCores); // Adicione 'logsModelos'
  
  // Escreve os dados totalmente corrigidos de volta na planilha
  range.setValues(dataFinal);
  
  // Grava o log unificado se houveram correções
  if (logsGerais.length > 0) {
    gravarLog(logsGerais);
    ss.toast(`${logsGerais.length} correções foram aplicadas. Veja a aba 'LOG_CORRECOES'.`);
  } else {
    Logger.log("Validações concluídas. Nenhuma correção foi necessária.");
  }
}


function validarECorrigirFornecedores(data) {
  const logDeCorrecoes = [];
  const normalize = (str) => String(str || '').toUpperCase().replace(/[\s-]+/g, '');

  data.forEach((linha, index) => {
    const fornecedorOriginal = String(linha[0] || '');
    if (!fornecedorOriginal) return;

    const nomeSemCodigo = fornecedorOriginal.replace(/\s*\d{4}$/, '').trim();
    const chaveBusca = normalize(nomeSemCodigo);
    const valorCorreto = mapaDeBuscaFornecedores.get(chaveBusca);

    if (valorCorreto && valorCorreto !== fornecedorOriginal) {
      // Se ENCONTROU e o valor é diferente, corrige e loga a CORREÇÃO.
      logDeCorrecoes.push({
        fornecedor: valorCorreto, // Loga o nome corrigido
        modelo: String(linha[2] || ""),
        campo: "Fornecedor",
        original: fornecedorOriginal,
        acao: `Corrigido para ${valorCorreto}`
      });
      linha[0] = valorCorreto; // Atualiza a célula
      
    } else if (!valorCorreto) {
      // Se NÃO ENCONTROU, não altera o dado, mas loga o ALERTA.
      logDeCorrecoes.push({
        fornecedor: fornecedorOriginal, // Loga o nome original
        modelo: String(linha[2] || ""),
        campo: "Fornecedor",
        original: fornecedorOriginal,
        acao: "ALERTA: Não encontrado no Glossário"
      });
    }
  });

  return [data, logDeCorrecoes];
}


function validarECorrigirCores(data) {
  const logDeCorrecoes = [];
  
  data.forEach((linha, index) => {
    const fornecedor = String(linha[0] || "");
    const modeloCorrigido = String(linha[2] || "");
    const corOriginal = String(linha[5] || "").toUpperCase();
    if (!modeloCorrigido || !corOriginal) return;

    const corCorrigida = getCorCorrigida(modeloCorrigido, corOriginal);

    if (corCorrigida !== corOriginal) {
      logDeCorrecoes.push({
        fornecedor: fornecedor,
        modelo: modeloCorrigido,
        campo: "Cor",
        original: corOriginal,
        acao: `Corrigido para ${corCorrigida}`
      });
      linha[5] = corCorrigida; // Atualiza a cor
    }
  });

  return [data, logDeCorrecoes];
}

function getCorCorrigida(modelo, cor) {
  let regraAplicavel = null;
  let melhorCorrespondencia = "";
  for (const chaveRegra in REGRAS_DE_CORES) {
    if (modelo.includes(chaveRegra) && chaveRegra.length > melhorCorrespondencia.length) {
      melhorCorrespondencia = chaveRegra;
      regraAplicavel = REGRAS_DE_CORES[chaveRegra];
    }
  }
  if (!regraAplicavel) return cor;

  let corProcessada = cor;
  if (regraAplicavel.conversoes && regraAplicavel.conversoes[cor]) {
    corProcessada = regraAplicavel.conversoes[cor];
  }
  if (regraAplicavel.coresValidas.includes(corProcessada)) {
    return corProcessada;
  }
  return "[COR INVÁLIDA]";
}


function gravarLog(logs) {
  const ss = SpreadsheetApp.getActiveSpreadsheet();
  const NOME_ABA_LOG = "LOG_CORRECOES";
  let logSheet = ss.getSheetByName(NOME_ABA_LOG);

  if (!logSheet) {
    logSheet = ss.insertSheet(NOME_ABA_LOG);
    // CABEÇALHO ATUALIZADO
    const cabecalho = ["Timestamp", "Fornecedor", "Modelo (Após Correção)", "Campo Corrigido", "Valor Original", "Ação Tomada / Valor Corrigido"];
    logSheet.appendRow(cabecalho);
    logSheet.getRange("A1:F1").setFontWeight("bold");
    logSheet.setFrozenRows(1);
    logSheet.setColumnWidth(1, 150); // Timestamp
    logSheet.setColumnWidths(2, 2, 200); // Fornecedor e Modelo
    logSheet.setColumnWidths(4, 3, 250); // Campo, Original e Ação
  }

  const timestamp = new Date();
  // MAPEAMENTO DE DADOS ATUALIZADO
  const dadosParaLog = logs.map(log => [
    timestamp,
    log.fornecedor,
    log.modelo,
    log.campo,
    log.original,
    log.acao
  ]);

  // RANGE DE COLUNAS ATUALIZADO DE 5 PARA 6
  logSheet.getRange(logSheet.getLastRow() + 1, 1, dadosParaLog.length, 6).setValues(dadosParaLog);
}

//========================================================================================= 
// NOVO BLOCO DE CÓDIGO - COLE NO FINAL DO SEU SCRIPT
// =========================================================================================

const GLOSSARIO_PRODUTOS = {
  "categorias_a_ignorar_no_log": ["ACSS", "MI", "NOTE", "PAD", "POCO", "PODS", "RDM", "REAL"],
  "modelos_por_categoria": {
    "IPH": {
      "IPHONE 11": { "capacidades_validas": ["64GB", "128GB", "256GB"] },
      "IPHONE 11 PRO MAX": { "capacidades_validas": ["64GB", "256GB", "512GB"] },
      "IPHONE 12": { "capacidades_validas": ["64GB", "128GB", "256GB"] },
      "IPHONE 12 PRO MAX": { "capacidades_validas": ["128GB", "256GB", "512GB"] },
      "IPHONE 13": { "capacidades_validas": ["128GB", "256GB", "512GB"] },
      "IPHONE 13 PRO": { "capacidades_validas": ["128GB", "256GB", "512GB", "1TB"] },
      "IPHONE 13 PRO MAX": { "capacidades_validas": ["128GB", "256GB", "512GB", "1TB"] },
      "IPHONE 14": { "capacidades_validas": ["128GB", "256GB", "512GB"] },
      "IPHONE 14 PRO": { "capacidades_validas": ["128GB", "256GB", "512GB", "1TB"] },
      "IPHONE 14 PRO MAX": { "capacidades_validas": ["128GB", "256GB", "512GB", "1TB"] },
      "IPHONE 15": { "capacidades_validas": ["128GB", "256GB", "512GB"] },
      "IPHONE 15 PLUS": { "capacidades_validas": ["128GB", "256GB", "512GB"] },
      "IPHONE 15 PRO": { "capacidades_validas": ["128GB", "256GB", "512GB", "1TB"] },
      "IPHONE 15 PRO MAX": { "capacidades_validas": ["256GB", "512GB", "1TB"] },
      "IPHONE 16": { "capacidades_validas": ["128GB", "256GB", "512GB"] },
      "IPHONE 17": { "capacidades_validas": ["256GB", "512GB"] },
      "IPHONE 17 AIR": { "capacidades_validas": ["256GB", "512GB", "1TB"] },
      "IPHONE 16E": { "capacidades_validas": ["128GB", "256GB"] },
      "IPHONE 16 PLUS": { "capacidades_validas": ["128GB", "256GB", "512GB"] },
      "IPHONE 16 PRO": { "capacidades_validas": ["128GB", "256GB", "512GB", "1TB"] },
      "IPHONE 16 PRO MAX": { "capacidades_validas": ["256GB", "512GB", "1TB"] },
      "IPHONE 17 PRO": { "capacidades_validas": ["256GB", "512GB", "1TB", "2TB"] },
      "IPHONE 17 PRO MAX": { "capacidades_validas": ["256GB", "512GB", "1TB", "2TB"] }
    },
    "PODS": {
      "AIRPODS 4": {},
      "AIRPODS PRO 3": {},
      "AIRPODS PRO 2": {},
      "AIRPODS MAX": {}
    },
    "IPAD": {
      "IPAD 9": { "capacidades_validas": ["64GB", "256GB"], "tamanhos_tela": ["10.2\""], "tamanho_padrao": "10.2\"", "mostrar_tamanho_tela": false },
      "IPAD 10": { "capacidades_validas": ["64GB", "256GB", "512GB"], "tamanhos_tela": ["10.9\""], "tamanho_padrao": "10.9\"" , "mostrar_tamanho_tela": false},
      "IPAD 11": { "capacidades_validas": ["128GB", "256GB","512GB"], "tamanhos_tela": ["10.9\""], "tamanho_padrao": "10.9\"" , "mostrar_tamanho_tela": false},
      "IPAD MINI 6": { "capacidades_validas": ["64GB", "256GB"], "tamanhos_tela": ["8.3\""], "tamanho_padrao": "8.3\"" , "mostrar_tamanho_tela": false},
      "IPAD MINI 7": { "capacidades_validas": ["128GB", "256GB", "512GB"], "tamanhos_tela": ["8.3\""], "tamanho_padrao": "8.3\"" , "mostrar_tamanho_tela": false},
      "IPAD AIR M1": { "capacidades_validas": ["64GB", "256GB"], "tamanhos_tela": ["11\""], "tamanho_padrao": "11\"" },
      "IPAD AIR M2": { "capacidades_validas": ["128GB", "256GB", "512GB", "1TB"], "tamanhos_tela": ["11\"", "13\""], "tamanho_padrao": "11\"" },
      "IPAD AIR M3": { "capacidades_validas": ["128GB", "256GB", "512GB", "1TB"], "tamanhos_tela": ["11\"", "13\""], "tamanho_padrao": "11\"" },
      "IPAD PRO 5": { "capacidades_validas": ["128GB", "256GB", "512GB", "1TB", "2TB"], "tamanhos_tela": ["12.9\""], "tamanho_padrao": "12.9\"" },
      "IPAD PRO M5": { "capacidades_validas": ["256GB", "512GB", "1TB", "2TB", "4TB"], "tamanhos_tela": ["11\"", "13\""], "tamanho_padrao": "11\"" }
    },
    "MCB": {
      "MACBOOK AIR M1": { "capacidades_validas": ["256GB", "512GB", "1TB", "2TB"], "tamanhos_tela": ["13\""], "tamanho_padrao": "13\"" },
      "MACBOOK AIR M2": { "capacidades_validas": ["256GB", "512GB", "1TB", "2TB"], "tamanhos_tela": ["13\"", "15\""], "tamanho_padrao": "13\"" },
      "MACBOOK AIR M3": { "capacidades_validas": ["256GB", "512GB", "1TB", "2TB"], "tamanhos_tela": ["13\"", "15\""], "tamanho_padrao": "13\"" },
      "MACBOOK AIR M4": { "capacidades_validas": ["256GB", "512GB", "1TB", "2TB"], "tamanhos_tela": ["13\"", "15\""], "tamanho_padrao": "13\"" },
      "MACBOOK AIR M5": { "capacidades_validas": ["256GB", "512GB", "1TB", "2TB", "4TB"], "tamanhos_tela": ["13\"", "15\""], "tamanho_padrao": "13\"" },
      "MACBOOK PRO M4": { "capacidades_validas": ["512GB", "1TB", "2TB"], "tamanhos_tela": ["14\"", "16\""], "tamanho_padrao": "14\"" },
       "MACBOOK PRO M5": { "capacidades_validas": ["512GB", "1TB", "2TB", "4TB", "8TB"], "tamanhos_tela": ["14\"", "16\""], "tamanho_padrao": "14\"" }
    },    "RLG": {
        "APPLE WATCH S10": {},
        "APPLE WATCH S11": { "tamanhos_pulseira_validos": ["42MM", "46MM"] },
        "APPLE WATCH ULTRA 3": { "tamanhos_pulseira_validos": ["49MM"] },
        "APPLE WATCH ULTRA 2": { "tamanhos_pulseira_validos": ["49MM"] }
    },


         "APPLE WATCH ULTRA 2": {
      "coresValidas": [
        "INDIGO ALPINE LOOP",
        "OLIVE ALPINE LOOP",
        "BLUE ALPINE LOOP",
        "ORANGE/BEIGE TL",
        "GREEN/GRAY TL",
        "BLUE/BLACK TL",
        "ORANGE OCEAN",
        "BLUE OCEAN",
        "WHITE OCEAN"
      ]
    },
    "APPLE WATCH ULTRA 3": {}
  },
  "conversoes_nomenclatura": {
    "IPAD AIR 5": "IPAD AIR M1",
    "IPAD PRO 6": "IPAD PRO M2",
    "IPHONE AIR": "IPHONE 17 AIR",
    "APPLE WATCH S11": "APPLE WATCH S11"
  }
};


/**
 * NOVA FUNÇÃO: Valida e corrige Modelo e GB.
 * @param {Array<Array<any>>} data A matriz de dados da planilha.
 * @returns {[Array<Array<any>>, Array<Object>]} Retorna os dados modificados e um array de logs.
 */
function validarModeloEGB(data) {
  const logDeCorrecoes = [];
  const glossario = GLOSSARIO_PRODUTOS.modelos_por_categoria;
  const conversoes = GLOSSARIO_PRODUTOS.conversoes_nomenclatura;
  const categoriasParaIgnorar = GLOSSARIO_PRODUTOS.categorias_a_ignorar_no_log || [];

  data.forEach((linha, index) => {
    const fornecedor = String(linha[0] || "");
    let modeloOriginal = String(linha[2] || "");
    const categoria = String(linha[1] || "");
    const gbOriginal = String(linha[3] || "");
    let modeloProcessado = modeloOriginal.toUpperCase();
    
    if (!modeloProcessado || !categoria) return;

    // --- PASSO 1: Normalização do Modelo ---
    for (const chave in conversoes) {
        if(modeloProcessado.includes(chave)) {
            modeloProcessado = modeloProcessado.replace(chave, conversoes[chave]);
        }
    }
    if (categoria === 'RLG' && modeloProcessado.includes(' GPS') && !modeloProcessado.includes('GPS + CELULAR')) {
      modeloProcessado = modeloProcessado.replace(' GPS', '').trim();
    }
    
    // --- PASSO 2: Identificação do Modelo no Glossário ---
    let regraDoModelo = null;
    if (glossario[categoria]) {
        let melhorCorrespondencia = "";
        for (const modeloPadrao in glossario[categoria]) {
            if (modeloProcessado.includes(modeloPadrao) && modeloPadrao.length > melhorCorrespondencia.length) {
                melhorCorrespondencia = modeloPadrao;
                regraDoModelo = glossario[categoria][modeloPadrao];
                regraDoModelo.nomePadrao = modeloPadrao;
            }
        }
    }

    if (!regraDoModelo) {
      // APLICA A REGRA DE EXCLUSÃO: SÓ LOGA SE A CATEGORIA NÃO ESTIVER NA LISTA PARA IGNORAR
      if (!categoriasParaIgnorar.includes(categoria)) {
          logDeCorrecoes.push({ fornecedor: fornecedor, modelo: modeloOriginal, campo: "Modelo", original: modeloOriginal, acao: "ALERTA: Não encontrado no Glossário" });
      }
      return; // Pula para a próxima linha
    }

    // --- PASSO 3: Validação de Atributos ---
    // a) Tamanho de Tela
    if (['MCB', 'IPAD'].includes(categoria) && regraDoModelo.tamanhos_tela) {
        const temTamanho = regraDoModelo.tamanhos_tela.some(t => modeloProcessado.includes(t));
        if (!temTamanho && regraDoModelo.tamanho_padrao && regraDoModelo.mostrar_tamanho_tela !== false) {
            const partes = modeloProcessado.split(/(WIFI|CELULAR)/);
            partes[0] = `${partes[0].trim()} ${regraDoModelo.tamanho_padrao} `;
            modeloProcessado = partes.join('').trim();
        }
    }
    
    if (modeloProcessado !== modeloOriginal.toUpperCase()) {
        logDeCorrecoes.push({ fornecedor: fornecedor, modelo: modeloProcessado, campo: "Modelo", original: modeloOriginal, acao: `Corrigido para ${modeloProcessado}` });
        linha[2] = modeloProcessado;
    }

    // b) Capacidade GB ou Tamanho de Pulseira (para Apple Watch)
    let gbProcessado = gbOriginal;
    
    // Padronizar "mm" para "MM" maiúsculo
    if (gbProcessado && gbProcessado.toLowerCase().includes('mm')) {
      const gbPadronizado = gbProcessado.replace(/mm/gi, 'MM');
      if (gbPadronizado !== gbOriginal) {
        logDeCorrecoes.push({ fornecedor: fornecedor, modelo: modeloProcessado, campo: "GB", original: gbOriginal, acao: `Padronizado para ${gbPadronizado}` });
        gbProcessado = gbPadronizado;
        linha[3] = gbPadronizado;
      }
    }
    
    // Validação de tamanhos de pulseira para Apple Watch
    const tamanhosPulseiraValidos = regraDoModelo.tamanhos_pulseira_validos;
    if (tamanhosPulseiraValidos) {
      if (!gbProcessado) {
        logDeCorrecoes.push({ fornecedor: fornecedor, modelo: modeloProcessado, campo: "Tamanho Pulseira", original: "VAZIO", acao: "ALERTA: Tamanho de pulseira faltando" });
      } else if (!tamanhosPulseiraValidos.includes(gbProcessado)) {
        const tamanhoMinimoValido = tamanhosPulseiraValidos[0];
        logDeCorrecoes.push({ fornecedor: fornecedor, modelo: modeloProcessado, campo: "Tamanho Pulseira", original: gbProcessado, acao: `Inválido (válidos: ${tamanhosPulseiraValidos.join(', ')}), corrigido para ${tamanhoMinimoValido}` });
        linha[3] = tamanhoMinimoValido;
      }
    }
    
    // Validação de capacidade GB para outros produtos
    const capacidadesValidas = regraDoModelo.capacidades_validas;
    if (capacidadesValidas) {
      if (!gbProcessado) {
        logDeCorrecoes.push({ fornecedor: fornecedor, modelo: modeloProcessado, campo: "GB", original: "VAZIO", acao: "ALERTA: GB Faltando" });
      } else if (!capacidadesValidas.includes(gbProcessado)) {
        const gbMinimoValido = capacidadesValidas[0];
        logDeCorrecoes.push({ fornecedor: fornecedor, modelo: modeloProcessado, campo: "GB", original: gbProcessado, acao: `Inválido, corrigido para ${gbMinimoValido}` });
        linha[3] = gbMinimoValido;
      }
    }
  });

  return [data, logDeCorrecoes];
}